<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="revisit-after" content="30 days"><meta name="robots" content="index, follow"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Ready For Business Automati... | enterprize | monitoring | ruby-on-rails | Dmytro Kovalov</title><meta name="description" content="Ready For Business (RFB) automation system is web-based application for executing system health checks, generating and distributing Ready For Business reports.
"><meta name="keywords" content="enterprize,monitoring,ruby-on-rails,ruby,ready for business,nagios,javascript"/><meta name="revised" content="Dmytro Kovalov,  2011/12/30"/><meta name="author" content="Dmytro Kovalov"/><link rel="icon" href="/images/favicon.ico"><link href='http://fonts.googleapis.com/css?family=Noto+Sans&subset=latin,cyrillic-ext' rel='stylesheet' type='text/css'><link href='http://fonts.googleapis.com/css?family=Seymour+One&subset=latin,cyrillic' rel='stylesheet' type='text/css'><link href='http://fonts.googleapis.com/css?family=Comfortaa&subset=latin,cyrillic-ext' rel='stylesheet' type='text/css'><link href='http://fonts.googleapis.com/css?family=Lobster&subset=latin,cyrillic-ext' rel='stylesheet' type='text/css'><link href='http://fonts.googleapis.com/css?family=Inconsolata:700' rel='stylesheet' type='text/css'><link rel="stylesheet" href="/assets/app-33b6fa0ef71a130443dfb1ef06bf0abb.css"> <script src="/assets/app-b80c4942bb62b4e63380a8693c39923c.js"></script><meta name="thefeedbackbutton" content="Github:ed4d541b3268b2dc5250684b57864d"> <script src="http://www.thefeedbackbutton.com/button.js"></script><style>#TheFeedbackButton{top:270px !important}</style><script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-33505287-1"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><meta name="google-translate-customization" content="e5305daecdf84461-c504f9bf5024d6b1-gef663547868bd15e-10"></meta></head><body><div id="fb-root"></div> <script>!function(e,t,n){var c,o=e.getElementsByTagName(t)[0];e.getElementById(n)||(c=e.createElement(t),c.id=n,c.src="//connect.facebook.net/en_US/all.js#xfbml=1",o.parentNode.insertBefore(c,o))}(document,"script","facebook-jssdk")</script> <script>!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://apis.google.com/js/plusone.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div id="tiki-top"><table style="margin:0;padding:0" cellspacing="0" cellpadding="0" width="100%" columns="3"><tbody><tr style="padding:0;margin:0"><td style="width:120px;background-color:#D9A005;color:#8b0b04;font-wight:bold;text-align:right;padding:1em;padding-top:2em;border:0;border-right:10px solid #000"><p class="motto plus">Лупайте сю скалу...</p><p class='motto'>Іван Франко</p></td><td style="border:0"> <a href="http://yarylo.sytes.net/"><img align="right" border="0" src="/images/yarylo.png"></a> <br clear="all"><div id="top_bar_title"> <a href="http://yarylo.sytes.net/dmytro" style="color:#8B0B04">Уроки пані Маєш</a></div><div style="float:left"><div class="fb-like" data-send="false" data-layout="button_count" data-width="450" data-show-faces="true"></div><div align="right" class="g-plusone" data-size="medium"></div></div><div style="float:right;padding:5px"><div ><img height="14" width="14" src="/images/feed-icon-14x14.png"> <a href="rss.xml">RSS</a> | <a href="atom.xml">Atom</a></div></div></td><td style="border:0;border-left:10px solid #000;width:200px;background-color:#8B0B04"><p class="editdate" style="font-size:small;color:#D9A005;margin:5px;margin-top:100px;margin-right:80px"> 28 April 2014</p></td></tr></tbody></table></div><div id="tiki-mid"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td id="leftcolumn"><p id="preamble"><a class="top" href="/"><h1>TOP »</h1></a><p><a name="tags"></a><div id='tag_cloud'> <a href="/tags.html#mac" title="mac" rel="8">mac</a> <a href="/tags.html#history" title="history" rel="9">history</a> <a href="/tags.html#solaris" title="solaris" rel="1">solaris</a> <a href="/tags.html#email" title="email" rel="2">email</a> <a href="/tags.html#sendmail" title="sendmail" rel="1">sendmail</a> <a href="/tags.html#cli" title="cli" rel="7">cli</a> <a href="/tags.html#nfs" title="nfs" rel="1">nfs</a> <a href="/tags.html#configuration" title="configuration" rel="15">configuration</a> <a href="/tags.html#interesting" title="interesting" rel="2">interesting</a> <a href="/tags.html#linux" title="linux" rel="6">linux</a> <a href="/tags.html#debian" title="debian" rel="4">debian</a> <a href="/tags.html#xwindow" title="xwindow" rel="1">xwindow</a> <a href="/tags.html#css" title="css" rel="4">css</a> <a href="/tags.html#disk" title="disk" rel="1">disk</a> <a href="/tags.html#books" title="books" rel="1">books</a> <a href="/tags.html#fun" title="fun" rel="1">fun</a> <a href="/tags.html#cobbler" title="cobbler" rel="1">cobbler</a> <a href="/tags.html#installation" title="installation" rel="3">installation</a> <a href="/tags.html#troubleshooting" title="troubleshooting" rel="2">troubleshooting</a> <a href="/tags.html#ntp" title="ntp" rel="1">ntp</a> <a href="/tags.html#environment" title="environment" rel="3">environment</a> <a href="/tags.html#perl" title="perl" rel="1">perl</a> <a href="/tags.html#request tracker" title="request tracker" rel="2">request tracker</a> <a href="/tags.html#ruby" title="ruby" rel="12">ruby</a> <a href="/tags.html#development" title="development" rel="5">development</a> <a href="/tags.html#gem" title="gem" rel="1">gem</a> <a href="/tags.html#nagios" title="nagios" rel="4">nagios</a> <a href="/tags.html#monitoring" title="monitoring" rel="4">monitoring</a> <a href="/tags.html#nagira" title="nagira" rel="4">nagira</a> <a href="/tags.html#ssh" title="ssh" rel="1">ssh</a> <a href="/tags.html#tmux" title="tmux" rel="2">tmux</a> <a href="/tags.html#tips" title="tips" rel="8">tips</a> <a href="/tags.html#unix" title="unix" rel="3">unix</a> <a href="/tags.html#shell" title="shell" rel="3">shell</a> <a href="/tags.html#zsh" title="zsh" rel="1">zsh</a> <a href="/tags.html#prompt" title="prompt" rel="1">prompt</a> <a href="/tags.html#RESTful API" title="RESTful API" rel="3">RESTful API</a> <a href="/tags.html#blog" title="blog" rel="3">blog</a> <a href="/tags.html#github" title="github" rel="3">github</a> <a href="/tags.html#jekyll" title="jekyll" rel="3">jekyll</a> <a href="/tags.html#chef" title="chef" rel="3">chef</a> <a href="/tags.html#capistrano" title="capistrano" rel="3">capistrano</a> <a href="/tags.html#deployment" title="deployment" rel="3">deployment</a> <a href="/tags.html#Japan" title="Japan" rel="14">Japan</a> <a href="/tags.html#Ukrainian" title="Ukrainian" rel="14">Ukrainian</a> <a href="/tags.html#travel" title="travel" rel="13">travel</a> <a href="/tags.html#culture" title="culture" rel="4">culture</a></div></p><h1 class="even">Selected projects <a style="float:right" href="/github.html"><b>See all » </b></a></h1><a href="/aws-deploy.html">AWS Deploy</a><a href="/banalize.html">Banalize: Bash static code analyzer</a><a href="/dbi-report-excel.html">DBIx::Report::Excel</a><a href="/dotfiles/index.html">Shell settings, AKA dotfiles</a><a href="/github_keys/index.html">Github keys</a><a href="/nagios_couchbase.html">Nagios Monitoring for Couchbase server</a><a href="/nagira/index.html">Nagira: RESTful API for Nagios</a><a href="/rfb.html">Ready For Business Automation system</a><a href="/rspec_normalized_hash/index.html">RSpec tests for Normalized Hash</a><a href="/Web-iPhoto/index.html">Web iPhoto</a><a name="blog"></a><h1>Blog <a style="float:right" href="/posts.html"><b>All posts » </b></a></h1> <a href="/series/Lito_na_pivnochi_YAponiyi.html"> Series: Літо на півночі Японії</a><a href="/2014/01/31/vytoky_ukrayinskoyi_wikipediyi.html">Витоки української Вікіпедії </a><a href="/2013/12/20/is_macosx_10.9_macos_9.x..html">Is MacOSX 10.9 == MacOS 9.x? </a><a href="/2013/12/04/running_chef_roles_from_capistrano.html">Running Chef roles from Capistrano </a><a href="/2013/11/01/chef_and_capistrano_integration.html">und Capiche </a><a href="/2013/10/29/optimizing_jekyll.html">Github & Jekyll: Speeding up Jekyll site</a><a href="/2013/08/13/more_about_jekyll.html">Github & Jekyll: More experience with Jekyll and setup changes</a><a href="/2013/05/21/easy_spawn_new_hosts_with_capistrano.html">Build new hosts with Capistrano and Chef </a><a href="/2013/05/15/custom_css_for_rt4.html">Request Tracker: More about custom CSS for RT4</a><a href="/2013/03/18/ruby_2_test_drive.html">Ruby 2 test drive </a><a href="/2013/03/15/nagira_v0.2.5_release.html">Nagira v0.2.5 release </a><a href="/2013/03/13/its_unix_my_dear_watson.html">It's UNIX my dear Watson </a><h1 class="even">Slides <a style="float:right" href="/presentations"><b>See all » </b></a></h1> <a href=/ presentations/ nagira_tlug. html>Nagira @TLUG, 2012</a><a href=/ presentations/ rspec_and_guard. html>Rspec and Guard</a><a name="about"></a><h1>About</h1><a href="http://uk.wikipedia.org/wiki/%D0%AF%D1%80%D0%B8%D0%BB%D0%BE">Ярило</a> <a href="https://en.wikipedia.org/wiki/Jarilo">Yarylo, Jarilo</a> <a href="http://github.com/dmytro">me @ github</a> <a href="http://search.cpan.org/~dmytro">me @ CPAN</a> <a href="http://tinyurl.com/7j89dhl"> Dmytro (CV)</a><p><p></td><td id="centercolumn"><div class="wikitext"><div class="titlebar"> Ready For Business Automation system<div style="float:right;padding-right:10px" id="google_translate_element"></div><script>function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"en",includedLanguages:"en,ja,uk",layout:google.translate.TranslateElement.InlineLayout.SIMPLE,multilanguagePage:!0,gaTrack:!0,gaId:"UA-33505287-1"},"google_translate_element")}</script><script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script></div><script>function createTOC(a,t){var e=0,h=$("<ul id='bookmarksList'>");$("#content").children(a).each(function(){$(this).html("<a name='bookmark"+e+"'></a>"+$(this).html()),h.append($("<li class='"+this.nodeName+"'><a href='#bookmark"+e++ +"'>"+$(this).text()+"</a></li>"))}),$("#"+t).append(h)}$("document").ready(function(){createTOC("h1,h2,h3,h4,h5,h6","TOC   ")})</script><style>#TOC.bookmarkList li{list-style-type:none}li:first-child{text-indent:0}.H1,.H2,.H3,.H4,.H5,.H6{display:block}.H1{text-indent:0;font-size:100%}.H2{text-indent:2ex;font-size:90%}.H3{text-indent:4ex;font-size:80%}.H4{text-indent:6ex;font-size:70%}.H5{text-indent:8ex;font-size:60%}.H6{text-indent:10ex;font-size:50%}</style><strong id="toc_title">Table Of Contents</strong><div id="TOC"></div><div id="content"><p>Ready For Business (<span class="caps">RFB</span>) automation system is web-based application for executing system health checks, generating and distributing Ready For Business reports.</p><p><span class="caps">RFB</span> system is built using Ruby On Rails (Ruby) and Ext JS (Javascript) web frameworks.</p><h1>Namespace</h1><p><img src="/images/rfb/folder_tree.png" alt=""/></p><h2>Namespace tree</h2><p>Namespace model implements tree-like hierarchy for describing regions, applications, departments, assets and health-check relationships in the <span class="caps">RFB</span> application. Namespace tree is generalized tree structure which provides: parent-child relationship, node path, node type information and some additional attributes, like for example timezone assotiation. Hierachy of the Namespace model has single root node and every node in the hierachy distinqushed by its type: folder, server or script.</p><p>In user web interface Namespace model imlpemented as canonic folder widget with:</p><ul><li>multiple selections</li><li>(multi) drag-and-drop editing (for moving tree nodes and adding associations)</li><li>configurable context menus and permissioning.</li></ul><p><img src="/images/rfb/drag-n-drop.png" alt=""/></p><p>Drag and drop editing of system checks. Multiple checks can be added simultaneously to multiple selected tree nodes</p><p>Namespace model implements Timezone support for nodes and provides methods for interaction with Schedule for automatic execution of health checks defined in HealthCheckclass?.</p><h1>Timezone support</h1><p><img src="/images/rfb/timezone_set.png" alt=""/></p><p>All system checks are executed at their local zone time. Zone time is re-calculated for each individual node and health check. Timezone support is implemented by Timezone class.</p><p>Timezone class provides timezone support for Namespace model. Namespace instances have attribute timezone which contains (optionally) name of the timezone from Timezone class. Iftimezone attribute is nil, node inherits timezone from one of the ancesstors (see below).</p><p>Timezone class relies on TZInfo::Timezone class.</p><h1>Health Checks</h1><p>Class HealthCheck implements health checks supported by <span class="caps">RFB</span> system.</p><p>HealthCheck contains string values (constants) of:</p> <pre>
     #
     #  check type - Manual, API submission, HTTP
     #
         CHECK_TYPES = ['Manual', 'HTTP', 'API submit']
         RAG status - red(failure), amber(warning), green(OK) and grey(Unknown).
           RAG = {
             0  =&gt; 'green',
             1  =&gt; 'amber',
             2  =&gt; 'red',
            -1  =&gt; 'grey',
           }</pre><h2>Health Check Configuration</h2><h3>Health Check types</h3><p><span class="caps">RFB</span> sustem implements three types of health check types: Manual, <span class="caps">API</span> and <span class="caps">HTTP</span>.</p><h4>Manual check</h4><p>Manual check is check, that can only be submitted by the operator of the <span class="caps">RFB</span> system. I.e. it does not contain configuration to classify check result (OK, Failure or others). And it does not contain configuration to retrieve status from <span class="caps">HTTP</span> <span class="caps">URI</span>.</p><p>Manual check, however, can be associated with a schedule. In this case <span class="caps">RFB</span> scheduler, will put manual task execution time in a run queue. <span class="caps">RFB</span> scheduler will also check that check is not overdue (i.e. its alert_if_unknown time has not passed). If it is expired, scheduler will mark task as failed.</p><h4><span class="caps">API</span> submission</h4><p><span class="caps">API</span> submission check additionally to time parameters of the Manual task have also configuration for check results parser (see Check Result Parser).</p><p>When <span class="caps">API</span> submission check is associated with a schedule, scheduler will checkalarm_if_unknown_time of the tasks, same as in Manual task case.</p><p><span class="caps">API</span> for the submission checks is described in details in <span class="caps">API</span> section of the manual.</p><h4><span class="caps">HTTP</span> active check</h4><p><span class="caps">HTTP</span> active check must contain valid <span class="caps">URI</span> of the <span class="caps">HTTP</span> server, where <span class="caps">RFB</span> system can retrieve object state. This can be either web-services <span class="caps">API</span> endpoint, or just plain <span class="caps">HTTP</span> server providing text file with check results.</p><p>Check result parser and time parameters are configured similarly to Manual check and <span class="caps">API</span> submission.</p><h3>Check result parser</h3><p>Check result parser configured by providing set of regular expressions in Ruby or Perl syntax used to parse script output. Parser can be configured to test regular expression against <span class="caps">STDOUT</span>, <span class="caps">STDERR</span> or numerical value of exit status of the script.</p><p>Checks are performed in predefined order: red, amber, green, grey. First match of the regular expression text is returned as check result. If regular expression match sets variable $1, it is used as check comment. Additionally, if <span class="caps">HTTP</span> check returns an <span class="caps">HTTP</span> error it is stored as check comment.</p><h1>Schedules</h1><p>Class Schedule implements support of task scheduling for <span class="caps">RFB</span> application. Each HealthCheckinstance? can have pointer to on of the existing schedules.</p><p>Model Schedule is similar to use job run time parameters in Autosys. Additinally Schedule model supports Autosys calendars. See Calendar for details.</p><p>Schedule object instances have following time attributes:</p><ul><li>Day attributes</li><li>Days of week – Three letter abbreviations of days of week. Space, comma or semicolon separated.</li><li>Run calendar – See Calendar</li><li>Exclude calendar – See Calendar</li></ul><h4>Time attributes</h4><p>Reset time – Datetime class. Before starting new day all checks are rest to ‘blank’ state at reset time.</p><p>Start times – Array of strings in the format HH:MM. Space, semicolon or comma separated. Eeach check can be executed multiple time throught the day.</p><p>Alarm if unknown time – Datetime class. If check is not completed by this time (is ‘blank’) it is marked by scheduler as failed.</p><p>HealthCheck instances that have schedule configured are processed by <span class="caps">RFB</span> scheduler and depending on the type of check (HealthCheck::CHECK_TYPES) can be either executed (<span class="caps">HTTP</span> type) or marked as failed if expired.</p><h2>Scheduler</h2><p>Scheduler in <span class="caps">RFB</span> system is implemented in two classes:</p><ul><li>RunQueue – Rails model, implementing queue table</li></ul><ul><li>and QueueRunner – background threaded loop for executing periodic tasks related to RunQueue: build queue, execute tasks from queue, remove tasks after completion.</li></ul></div></table><div id="tiki-bot"><table style="border-:0;border-top:10px solid #000;margin:0;padding:0" cellspacing="0" cellpadding="0" width="100%" columns="2"><tbody><tr style="padding:0;margin:0"><td style="width:80%;background-color:#052D6C;color:#8b0b04;font-style:italic;font-wight:bold;text-align:right;border:0"> <br clear="all"><br clear="all"><br clear="all"><br clear="all"></td><td style="border:0;border-left:10px solid #000;width:120px;padding:5px"> <a class="address" href="mailto:dmytro.kovalov@gmail.com">дмитро ковальов</a></br> <a class="address" href="https://dmytro.github.com/">dmytro @ github </a><br> <a class="address" href="http://dmytro.sytes.net">dmytro.sytes.net</a><br></td></tr></tbody></table></div> <script>$("#content table tr:even").attr("class","even")</script></body></html>