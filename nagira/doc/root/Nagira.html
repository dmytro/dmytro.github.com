<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Nagira
  
    &mdash; Documentation by YARD 0.8.1
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (N)</a> &raquo;
    
    
    <span class="title">Nagira</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Nagira
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Sinatra::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Sinatra::Base</li>
          
            <li class="next">Nagira</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">app.rb<span class="defines">,<br />
  lib/nagira.rb</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Main class of Nagira application implementing RESTful API for Nagios.</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="VERSION-constant" class="">VERSION =
          
        </dt>
        <dd><pre class="code"><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_expand_path'>expand_path</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='kw'>__FILE__</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/../version.txt</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span></pre></dd>
      
        <dt id="GITHUB-constant" class="">GITHUB =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://dmytro.github.com/nagira/</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%2F-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(&quot;/&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>HTTP response.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#api-instance_method" title="#api (instance method)">- (Object) <strong>api</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get all routes that Nagira provides.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear_instance_data-instance_method" title="#before (instance method)">- (Object) <strong>before</strong>(&quot;clear data&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clear values onf instance variables before start.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_jsonp_callback-instance_method" title="#before (instance method)">- (Object) <strong>before</strong>('find callback name') </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Detects if request is using jQuery JSON-P and sets @callback variable.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_1_object-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(&quot;/_objects/:type/:name&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get single Nagios object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_api-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(&quot;/_api&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Provide information about API routes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_config-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(&quot;/_config&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get Nagios configuration.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_object_type-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(&quot;/_objects/:type&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get all objects of type :type.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_objects-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(&quot;/_objects&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get full list of Nagios objects.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_status-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(&quot;/_status&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>All hosts status.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_status_hostname-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(&quot;/_status/:hostname&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Hoststatus for single host.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_status_hostname_services-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(&quot;/_status/:hostname/_services&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>All services for single host.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_status_hostname_services_service_name-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(&quot;/_status/:hostname/_services/:service_name&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Full or short status information for single service on single host.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#object_not_found-instance_method" title="#after (instance method)">- (Object) <strong>after</strong>(&quot;Object not found or bad request&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>If result-set of object/status search is empty return HTTP 404 .</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_nagios_files-instance_method" title="#before (instance method)">- (Object) <strong>before</strong>(&quot;parse Nagios files&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Parse nagios files.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#return_jsonp_data-instance_method" title="#after (instance method)">- (Object) <strong>after</strong>(&quot;Return formatted data&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>If it's a JSON-P request, return its data with prepended @callback function
name.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#strip_extensions-instance_method" title="#before (instance method)">- (Object) <strong>before</strong>(&quot;detect format&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Detect and strip output format extension.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#strip_output_type-instance_method" title="#before (instance method)">- (Object) <strong>before</strong>('detect output mode') </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Detect output mode modifier.</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="/-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(&quot;/&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>HTTP response. Hash formatted in the format defined by requested output
type(XML, YAML or JSON).</p>


  </div>
</div>
<div class="tags">
  
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>HTTP response. Hash formatted in the format defined by requested output
type(XML, YAML or JSON).</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


416
417
418
419
420
421
422
423
424</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 416</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:application</span> <span class='op'>=&gt;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='comma'>,</span>
    <span class='symbol'>:version</span> <span class='op'>=&gt;</span> <span class='const'>VERSION</span><span class='comma'>,</span>
    <span class='symbol'>:source</span> <span class='op'>=&gt;</span> <span class='const'>GITHUB</span><span class='comma'>,</span>
    <span class='symbol'>:apiUrl</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/api</span><span class='tstring_end'>&quot;</span></span>
  <span class='rbrace'>}</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="api-instance_method">
  
    - (<tt>Object</tt>) <strong>api</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get all routes that Nagira provides.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nagira.rb', line 27</span>

<span class='kw'>def</span> <span class='id identifier rubyid_api'>api</span> 
  <span class='id identifier rubyid_api'>api</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='rbrace'>}</span>
  
  <span class='id identifier rubyid_param_regex'>param_regex</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\(\[\^\\\\\/\?\#\]\+\)</span><span class='tstring_end'>'</span></span>
  <span class='const'>Nagira</span><span class='period'>.</span><span class='id identifier rubyid_routes'>routes</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_method'>method</span><span class='op'>|</span>
    <span class='id identifier rubyid_api'>api</span><span class='lbracket'>[</span><span class='id identifier rubyid_method'>method</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='const'>Nagira</span><span class='period'>.</span><span class='id identifier rubyid_routes'>routes</span><span class='lbracket'>[</span><span class='id identifier rubyid_method'>method</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
      <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_r'>r</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='lbracket'>[</span><span class='int'>3</span><span class='op'>..</span><span class='op'>-</span><span class='int'>3</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_r'>r</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_parm'>parm</span><span class='op'>|</span>
        <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='id identifier rubyid_param_regex'>param_regex</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_parm'>parm</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\</span><span class='tstring_end'>'</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_api'>api</span><span class='lbracket'>[</span><span class='id identifier rubyid_method'>method</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_path'>path</span> <span class='kw'>unless</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> 
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_api'>api</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clear_instance_data-instance_method">
  
    - (<tt>Object</tt>) <strong>before</strong>(&quot;clear data&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Clear values onf instance variables before start.</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 107</span>

<span class='id identifier rubyid_before'>before</span> <span class='kw'>do</span> 
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@format</span> <span class='op'>=</span> <span class='ivar'>@output</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_jsonp_callback-instance_method">
  
    - (<tt>Object</tt>) <strong>before</strong>('find callback name') 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Detects if request is using jQuery JSON-P and sets @callback variable.
@callback variable is used if after method and prepends JSON data with
callback function name.</p>

<h1>Example</h1>

<p>GET /_api?callback=jQuery12313123123 # @callback == jQuery12313123123</p>

<p>JSONP support is based on the code from <tt>sinatra/jsonp</tt> Gem <a
href="https://github.com/shtirlic/sinatra-jsonp">github.com/shtirlic/sinatra-jsonp</a>.</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


179
180
181
182
183
184
185</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 179</span>

<span class='id identifier rubyid_before'>before</span> <span class='kw'>do</span>
  <span class='kw'>if</span> <span class='ivar'>@format</span> <span class='op'>==</span> <span class='symbol'>:json</span>
    <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>callback</span><span class='tstring_end'>'</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>jscallback</span><span class='tstring_end'>'</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>jsonp</span><span class='tstring_end'>'</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>jsoncallback</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
      <span class='ivar'>@callback</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='ivar'>@callback</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_1_object-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(&quot;/_objects/:type/:name&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get single Nagios object.</p>

<p><b>Accepted output type modifiers:</b></p>
<ul><li>
<p>none</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
  
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>:type</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Type is one of Nagios objects like  hosts, hostgroupsroups, etc.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>:name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>HTTP response. Hash formatted in the format defined by requested output
type(XML, YAML or JSON).</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


302
303
304
305
306
307
308
309
310</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 302</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_objects/:type/:name</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
  <span class='kw'>begin</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@objects</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span>
  <span class='kw'>rescue</span> <span class='const'>NoMethodError</span>
    <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_api-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(&quot;/_api&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Provide information about API routes</p>


  </div>
</div>
<div class="tags">
  
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>HTTP response. Hash formatted in the format defined by requested output
type(XML, YAML or JSON).</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


410
411
412
413</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 410</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_api</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> 
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_api'>api</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_config-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(&quot;/_config&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get Nagios configuration.</p>

<p>Get Nagios configuration hash form parsing main Nagios configuration file
nagios.cfg</p>


  </div>
</div>
<div class="tags">
  
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>HTTP response. Hash formatted in the format defined by requested output
type(XML, YAML or JSON).</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


241
242
243
244</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 241</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_config</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_object_type-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(&quot;/_objects/:type&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get all objects of type :type</p>

<p><b>Accepted output type modifiers:</b></p>
<ul><li>
<p><tt>/_list</tt> : Short list of available objects, depending on the current
request context: hosts, services, etc.</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
  
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>:type</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Type is one of Nagios objects like  hosts, hostgroupsroups, etc.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>HTTP response. Hash formatted in the format defined by requested output
type(XML, YAML or JSON).</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


280
281
282
283
284
285
286
287
288
289</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 280</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_objects/:type</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_type'>type</span><span class='op'>|</span>
  <span class='kw'>begin</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@objects</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span> <span class='kw'>if</span> <span class='ivar'>@output</span> <span class='op'>==</span> <span class='symbol'>:list</span>
  <span class='kw'>rescue</span> <span class='const'>NoMethodError</span>
    <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_objects-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(&quot;/_objects&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get full list of Nagios objects. Returns hash containing all configured
objects in Nagios: hosts, hostgroups, services, contacts. etc.</p>

<p><b>Accepted output type modifiers:</b></p>
<ul><li>
<p><tt>/_list</tt> : Short list of available objects, depending on the current
request context: hosts, services, etc.</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>HTTP response. Hash formatted in the format defined by requested output
type(XML, YAML or JSON).</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


260
261
262
263
264
265
266
267
268</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 260</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_objects</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='kw'>begin</span>
            <span class='ivar'>@output</span> <span class='op'>==</span> <span class='symbol'>:list</span> <span class='op'>?</span> <span class='ivar'>@objects</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span> <span class='op'>:</span> <span class='ivar'>@objects</span>
          <span class='kw'>rescue</span> <span class='const'>NoMethodError</span> 
            <span class='kw'>nil</span>
          <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_status-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(&quot;/_status&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>All hosts status.</p>

<p><b>Accepted output type modifiers:</b></p>
<ul><li>
<p><tt>/_state</tt> - Instead of full status information send only current
state. For hosts up/down, for services OK, Warn, Critical, Unknown
(0,1,2-1)</p>
</li><li>
<p><tt>/_list</tt> : Short list of available objects, depending on the current
request context: hosts, services, etc.</p>
</li><li>
<p><tt>/_full</tt> - Show full status information TODO Not implemented</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>HTTP response. Hash formatted in the format defined by requested output
type(XML, YAML or JSON).</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


391
392
393
394
395
396
397
398
399
400
401
402</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 391</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_status</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@status</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>

  <span class='kw'>case</span> <span class='ivar'>@output</span> 
  <span class='kw'>when</span> <span class='symbol'>:state</span>
    <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hoststatus</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>host_name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>current_state</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='symbol'>:list</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_status_hostname-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(&quot;/_status/:hostname&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Hoststatus for single host</p>

<p><b>Accepted output type modifiers:</b></p>
<ul><li>
<p><tt>/_state</tt> - Instead of full status information send only current
state. For hosts up/down, for services OK, Warn, Critical, Unknown
(0,1,2-1)</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
  
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>:hostname</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Configured Nagios hostname</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>HTTP response. Hash formatted in the format defined by requested output
type(XML, YAML or JSON).</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


371
372
373
374
375
376
377
378
379</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 371</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_status/:hostname</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hostname'>hostname</span><span class='op'>|</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@status</span><span class='lbracket'>[</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hoststatus</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>

  <span class='kw'>if</span> <span class='ivar'>@output</span> <span class='op'>==</span> <span class='symbol'>:state</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>host_name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>current_state</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_status_hostname_services-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(&quot;/_status/:hostname/_services&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>All services for single host.</p>

<p><b>Accepted output type modifiers:</b></p>
<ul><li>
<p><tt>/_state</tt> - Instead of full status information send only current
state. For hosts up/down, for services OK, Warn, Critical, Unknown
(0,1,2-1)</p>
</li><li>
<p><tt>/_list</tt> : Short list of available objects, depending on the current
request context: hosts, services, etc.</p>
</li><li>
<p><tt>/_full</tt> - Show full status information TODO Not implemented</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
  
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>:hostname</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Configured Nagios hostname</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>HTTP response. Hash formatted in the format defined by requested output
type(XML, YAML or JSON).</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


348
349
350
351
352
353
354
355
356
357
358
359
360</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 348</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_status/:hostname/_services</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hostname'>hostname</span><span class='op'>|</span>

  <span class='kw'>case</span> <span class='ivar'>@output</span>
  <span class='kw'>when</span> <span class='symbol'>:list</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@status</span><span class='lbracket'>[</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>servicestatus</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
  <span class='kw'>when</span> <span class='symbol'>:state</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@status</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>host_name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>service_description</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>current_state</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@status</span><span class='lbracket'>[</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>servicestatus</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_status_hostname_services_service_name-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(&quot;/_status/:hostname/_services/:service_name&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Full or short status information for single service on single host.</p>

<p><b>Accepted output type modifiers:</b></p>
<ul><li>
<p><tt>/_state</tt> - Instead of full status information send only current
state. For hosts up/down, for services OK, Warn, Critical, Unknown
(0,1,2-1)</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
  
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>:hostname</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Configured Nagios hostname</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>:service_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Configured Nagios service for the host</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>HTTP response. Hash formatted in the format defined by requested output
type(XML, YAML or JSON).</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


328
329
330
331
332
333
334
335
336</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 328</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_status/:hostname/_services/:service_name</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hostname'>hostname</span><span class='comma'>,</span><span class='id identifier rubyid_service'>service</span><span class='op'>|</span>

  <span class='kw'>if</span> <span class='ivar'>@output</span> <span class='op'>==</span> <span class='symbol'>:state</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@status</span><span class='lbracket'>[</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>servicestatus</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_service'>service</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hostname</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>service_description</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>current_state</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@status</span><span class='lbracket'>[</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>servicestatus</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_service'>service</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="object_not_found-instance_method">
  
    - (<tt>Object</tt>) <strong>after</strong>(&quot;Object not found or bad request&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>If result-set of object/status search is empty return HTTP 404 . This can
happen when you are requesting status for not existing host and/or service.</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


196
197
198
199
200
201
202
203
204</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 196</span>

<span class='id identifier rubyid_after'>after</span> <span class='kw'>do</span>
  <span class='kw'>if</span> <span class='op'>!</span> <span class='ivar'>@data</span> <span class='op'>||</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_halt'>halt</span> <span class='lbracket'>[</span><span class='int'>404</span><span class='comma'>,</span> <span class='lbrace'>{</span>
            <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Object not found or bad request</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> 
            <span class='symbol'>:error</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP::Notfound</span><span class='tstring_end'>&quot;</span></span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to_</span><span class='embexpr_beg'>#{</span><span class='ivar'>@format</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
         <span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_nagios_files-instance_method">
  
    - (<tt>Object</tt>) <strong>before</strong>(&quot;parse Nagios files&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Parse nagios files.</p>

<p>Note: *.parse methods are monkey-patched here (if you have required
'lib/nagira' above) to set min parsing interval to avoid file paring on
each HTTP request. File is parsed only if it was changed and if it was
parsed more then 60 (default) seconds ago. See
<tt>lib/nagira/timed_parse.rb</tt> for mor more info.</p>

<p>In development mode use files located under <tt>./test/data</tt> directory.
This allows to do development on the host where Nagios is notinstalled. If
you want to change this edit configuration in config/environment.rb file.</p>

<p>See also comments in config/default.rb file regarding nagios_cfg,
status_cfg, objects_cfg.</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 81</span>

<span class='id identifier rubyid_before'>before</span> <span class='kw'>do</span> 

  <span class='gvar'>$nagios</span> <span class='op'>||=</span> <span class='lbrace'>{</span> <span class='symbol'>:config</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='symbol'>:objects</span> <span class='op'>=&gt;</span> <span class='kw'>nil</span> <span class='rbrace'>}</span>
  
  <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span>  <span class='op'>||=</span> <span class='const'>Nagios</span><span class='op'>::</span><span class='const'>Config</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='const'>Nagira</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_nagios_cfg'>nagios_cfg</span>
  <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span>

  <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span>  <span class='op'>||=</span> <span class='const'>Nagios</span><span class='op'>::</span><span class='const'>Status</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>  <span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_status_cfg'>status_cfg</span> <span class='op'>||</span> 
                                             <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_status_file'>status_file</span>
                                             <span class='rparen'>)</span>
  <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:objects</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'>Nagios</span><span class='op'>::</span><span class='const'>Objects</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_objects_cfg'>objects_cfg</span> <span class='op'>||</span> 
                                             <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_object_cache_file'>object_cache_file</span>
                                             <span class='rparen'>)</span>
  <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span>
  <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:objects</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span>

  <span class='ivar'>@status</span>   <span class='op'>=</span> <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hosts</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@objects</span>  <span class='op'>=</span> <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:objects</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_objects'>objects</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="return_jsonp_data-instance_method">
  
    - (<tt>Object</tt>) <strong>after</strong>(&quot;Return formatted data&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>If it's a JSON-P request, return its data with prepended @callback function
name. JSONP request is detected by <tt>before</tt> method.</p>

<p>If no callback paramete given, then simply return formatted data as XML,
JSON, or YAML in response body.</p>

<h1>Example</h1>

<pre class="code ruby"><code>$ curl  'http://localhost:4567/?callback=test'
    test([&quot;{\&quot;application\&quot;:\&quot;Nagira\&quot;,\&quot;version\&quot;:\&quot;0.1.3\&quot;,\&quot;url\&quot;:\&quot;http://dmytro.github.com/nagira/\&quot;}&quot;])</code></pre>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


221
222
223</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 221</span>

<span class='id identifier rubyid_after'>after</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_body'>body</span><span class='lparen'>(</span> <span class='ivar'>@callback</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@callback</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='ivar'>@data</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to_</span><span class='embexpr_beg'>#{</span><span class='ivar'>@format</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="strip_extensions-instance_method">
  
    - (<tt>Object</tt>) <strong>before</strong>(&quot;detect format&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Detect and strip output format extension</p>

<p>Strip extension (@format) from HTTP route and set it as instance variable
@format. Valid formats are .xml, .json, .yaml. If format is not specified,
it is set to default format (Nagira.settings.format).</p>

<p>@format can be assigned one of the symbols: :xml, :json, :yaml.</p>

<h1>Examples</h1>

<pre class="code ruby"><code>GET /_objects              # =&gt; default format
GET /_objects.json         # =&gt; :json
GET /_status/_list.yaml    # =&gt; :yaml</code></pre>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


131
132
133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 131</span>

<span class='id identifier rubyid_before'>before</span> <span class='kw'>do</span> 
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path_info'>path_info</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_format_extensions'>format_extensions</span><span class='rbrace'>}</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='ivar'>@format</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='backref'>$1</span> <span class='op'>||</span> <span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_format'>format</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>application/</span><span class='embexpr_beg'>#{</span><span class='ivar'>@format</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="strip_output_type-instance_method">
  
    - (<tt>Object</tt>) <strong>before</strong>('detect output mode') 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Detect output mode modifier</p>

<p>Detect and strip output type from HTTP route. Full list of output types is
<tt>:list</tt>, <tt>:state</tt> or <tt>:full</tt>, corresponding to
(+/list, <tt>/state</tt>, <tt>/full</tt> routes).</p>

<p>Output type defined by route modifier appended to the end of HTTP route. If
no output type specfied it is set to <tt>:full</tt>. Output mode can be
followed by format extension (<tt>.json</tt>, <tt>.xml</tt> or
<tt>.yaml</tt>).</p>

<h1>Examples</h1>

<pre class="code ruby"><code>GET /_objects/_list     # =&gt; :list
GET /_status/_state     # =&gt; :state
GET /_status/:hostname  # =&gt; :full
GET /_status            # =&gt; :full</code></pre>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


159
160
161
162</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 159</span>

<span class='id identifier rubyid_before'>before</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path_info'>path_info</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\/_(list|state)$</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='ivar'>@output</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='backref'>$1</span> <span class='op'>||</span> <span class='symbol'>:full</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Wed Sep 26 18:40:31 2012 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.1 (ruby-1.9.3).
</div>

  </body>
</html>