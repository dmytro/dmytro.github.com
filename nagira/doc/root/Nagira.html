<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Nagira
  
    &mdash; Documentation by YARD 0.8.7
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (N)</a> &raquo;
    
    
    <span class="title">Nagira</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Nagira
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Sinatra::Base</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Sinatra::Base</li>
          
            <li class="next">Nagira</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/app.rb<span class="defines">,<br />
  lib/nagira.rb,<br /> lib/app/routes/put.rb,<br /> lib/app/routes/put/host.rb,<br /> lib/app/routes/get/status.rb,<br /> lib/app/routes/put/status.rb,<br /> lib/app/routes/get/config.rb,<br /> lib/app/routes/get/objects.rb</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>PUT method routes for services status.</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="VERSION-constant" class="">VERSION =
          
        </dt>
        <dd><pre class="code"><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_expand_path'>expand_path</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='kw'>__FILE__</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/../version.txt</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span></pre></dd>
      
        <dt id="GITHUB-constant" class="">GITHUB =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>http://dmytro.github.com/nagira/</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="AR_PREFIX-constant" class="">AR_PREFIX =
          <div class="docstring">
  <div class="discussion">
    
<p>When this prefix added to routes convert output to ActiveResource
compatible format (basically Array instead of Hash).</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/ar</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#api-instance_method" title="#api (instance method)">- (Object) <strong>api</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get all routes that Nagira provides.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#argument_error-instance_method" title="#after (instance method)">- (Object) <strong>after</strong>(&quot;ArgumentError&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return 400 if result of PUT operation is not success.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear_instance_data-instance_method" title="#before (instance method)">- (Object) <strong>before</strong>(&quot;clear data&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clear values onf instance variables before start.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#convert_to_active_resource-instance_method" title="#after (instance method)">- (Object) <strong>after</strong>(&quot;Return Array for ActiveResouce routes&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_jsonp_callback-instance_method" title="#before (instance method)">- (Object) <strong>before</strong>(&#39;find callback name&#39;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Detects if request is using jQuery JSON-P and sets @callback variable.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_1_object-instance_method" title="#get_1_object (instance method)">- (Object) <strong>get_1_object</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get single Nagios object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_api-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(/_api)) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Provide information about API routes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_config-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(&quot;/_config&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get Nagios configuration hash form parsing main Nagios configuration file
nagios.cfg.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_object_type-instance_method" title="#get_object_type (instance method)">- (Object) <strong>get_object_type</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get all objects of type :type.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_objects-instance_method" title="#get_objects (instance method)">- (Object) <strong>get_objects</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get full list of Nagios objects.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_runtime_config-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(/_runtime)) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Print out nagira runtime configuration.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_slash-instance_method" title="#get (instance method)">- (Object) <strong>get</strong>(/)) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns application information: name, version, github repository.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_status-instance_method" title="#get_status (instance method)">- (Object) <strong>get_status</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return all hosts status.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_status_hostname-instance_method" title="#get_status_hostname (instance method)">- (Object) <strong>get_status_hostname</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Hoststatus for single host.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_status_hostname_services-instance_method" title="#get_status_hostname_services (instance method)">- (Object) <strong>get_status_hostname_services</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Endpoints:  -  GET /_status/:hostname/_services -  GET
/_status/:hostname/_hostcomments -  GET
/_status/:hostname/_servicecomments.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_status_hostname_services_service_name-instance_method" title="#get_status_hostname_services_service_name (instance method)">- (Object) <strong>get_status_hostname_services_service_name</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Full or short status information for single service on single host.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#object_not_found-instance_method" title="#after (instance method)">- (Object) <strong>after</strong>(&quot;Object not found or bad request&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>If result-set of object/status search is empty return HTTP 404 .</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_input_data-instance_method" title="#before (instance method)">- (Array) <strong>before</strong>(&quot;Parse PUT request body&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Process the data before on each HTTP request.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_nagios_files-instance_method" title="#before (instance method)">- (Object) <strong>before</strong>(&quot;Parse Nagios files&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Parse nagios files.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#put__host_status_host_name-instance_method" title="#put (instance method)">- (Object) <strong>put</strong>(&quot;/_host_status/:host_name&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Same as /_status/:host_name (Not implemented).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#put_status-instance_method" title="#put (instance method)">- (Object) <strong>put</strong>(&quot;/_status&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Submit JSON Hash for multiple services,  on multiple hosts.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#put_status_as_http_parms-instance_method" title="#put (instance method)">- (Object) <strong>put</strong>(/_status/:host_name/_services/:service_description/_return_code/:return_code/_plugin_output/:plugin_output) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Update single service status on a single host.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#put_status_host_name-instance_method" title="#put (instance method)">- (Object) <strong>put</strong>(&quot;/_status/:host_name&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Update hoststatus information only for the given host.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#put_status_host_name_services-instance_method" title="#put (instance method)">- (Object) <strong>put</strong>(&quot;/_status/:host_name/_services&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Update multiple services on the same host.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#return_jsonp_data-instance_method" title="#after (instance method)">- (Object) <strong>after</strong>(&quot;Return formatted data&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>If it&#39;s a JSON-P request, return its data with prepended @callback
function name.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#startup_configuration-instance_method" title="#before (instance method)">- (Object) <strong>before</strong>(&quot;Initial Config&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Do some necessary tasks at start and then run Sinatra app.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#strip_extensions-instance_method" title="#before (instance method)">- (Object) <strong>before</strong>(&quot;detect format&quot;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Detect and strip output format extension.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#strip_output_type-instance_method" title="#before (instance method)">- (Object) <strong>before</strong>(&#39;detect output mode&#39;) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Detect output mode modifier.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_host_status-instance_method" title="#update_host_status (instance method)">- (Object) <strong>update_host_status</strong>(params) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Small helper to submit data to ::Nagios::ExternalCommands object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_service_status-instance_method" title="#update_service_status (instance method)">- (Object) <strong>update_service_status</strong>(params) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Small helper to submit data to ::Nagios::ExternalCommands object.</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="api-instance_method">
  
    - (<tt>Object</tt>) <strong>api</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get all routes that Nagira provides.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nagira.rb', line 41</span>

<span class='kw'>def</span> <span class='id identifier rubyid_api'>api</span> 
  <span class='id identifier rubyid_api'>api</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='rbrace'>}</span>
  
  <span class='id identifier rubyid_param_regex'>param_regex</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\(\[\^\\\\\/\?\#\]\+\)</span><span class='tstring_end'>&#39;</span></span>
  <span class='const'>Nagira</span><span class='period'>.</span><span class='id identifier rubyid_routes'>routes</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_method'>method</span><span class='op'>|</span>
    <span class='id identifier rubyid_api'>api</span><span class='lbracket'>[</span><span class='id identifier rubyid_method'>method</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='const'>Nagira</span><span class='period'>.</span><span class='id identifier rubyid_routes'>routes</span><span class='lbracket'>[</span><span class='id identifier rubyid_method'>method</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
      <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_r'>r</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='lbracket'>[</span><span class='int'>3</span><span class='op'>..</span><span class='op'>-</span><span class='int'>3</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_r'>r</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_parm'>parm</span><span class='op'>|</span>
        <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='id identifier rubyid_param_regex'>param_regex</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_parm'>parm</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\\</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_api'>api</span><span class='lbracket'>[</span><span class='id identifier rubyid_method'>method</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_path'>path</span> <span class='kw'>unless</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> 
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_api'>api</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="argument_error-instance_method">
  
    - (<tt>Object</tt>) <strong>after</strong>(&quot;ArgumentError&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return 400 if result of PUT operation is not success.</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


284
285
286
287</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app.rb', line 284</span>

<span class='id identifier rubyid_after'>after</span> <span class='kw'>do</span> 
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put?'>put?</span>
  <span class='id identifier rubyid_halt'>halt</span> <span class='lbracket'>[</span><span class='int'>400</span><span class='comma'>,</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to_</span><span class='embexpr_beg'>#{</span><span class='ivar'>@format</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbracket'>]</span> <span class='kw'>if</span> <span class='op'>!</span> <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='symbol'>:result</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clear_instance_data-instance_method">
  
    - (<tt>Object</tt>) <strong>before</strong>(&quot;clear data&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Clear values onf instance variables before start.</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


171
172
173
174</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app.rb', line 171</span>

<span class='id identifier rubyid_before'>before</span> <span class='kw'>do</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@format</span> <span class='op'>=</span> <span class='ivar'>@output</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="convert_to_active_resource-instance_method">
  
    - (<tt>Object</tt>) <strong>after</strong>(&quot;Return Array for ActiveResouce routes&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


295
296
297</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app.rb', line 295</span>

<span class='id identifier rubyid_after'>after</span> <span class='kw'>do</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span> <span class='kw'>if</span> <span class='ivar'>@active_resource</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_jsonp_callback-instance_method">
  
    - (<tt>Object</tt>) <strong>before</strong>(&#39;find callback name&#39;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Detects if request is using jQuery JSON-P and sets @callback variable.
@callback variable is used if after method and prepends JSON data with
callback function name.</p>

<h1 id="label-Example">Example</h1>

<pre class="code ruby"><code class="ruby"><span class='const'>GET</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='regexp_end'>_api?callback=jQuery12313123123 # @callback == jQuery12313123123</span></span></code></pre>

<p>JSONP support is based on the code from <code>sinatra/jsonp</code> Gem <a
href="https://github.com/shtirlic/sinatra-jsonp">github.com/shtirlic/sinatra-jsonp</a>.</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


249
250
251
252
253
254
255</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app.rb', line 249</span>

<span class='id identifier rubyid_before'>before</span> <span class='kw'>do</span>
  <span class='kw'>if</span> <span class='ivar'>@format</span> <span class='op'>==</span> <span class='symbol'>:json</span>
    <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>callback</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>jscallback</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>jsonp</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>jsoncallback</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
      <span class='ivar'>@callback</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='ivar'>@callback</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_1_object-instance_method">
  
    - (<tt>Object</tt>) <strong>get_1_object</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get single Nagios object.</p>

<p><strong>Accepted output type modifiers:</strong></p>
<ul><li>
<p>none</p>
</li></ul>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>:type</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Type is one of Nagios objects like  hosts, hostgroupsroups, etc.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>:name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


59
60
61
62
63
64
65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/get/objects.rb', line 59</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_objects/:type/:name</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
  <span class='kw'>begin</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@objects</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span>
  <span class='kw'>rescue</span> <span class='const'>NoMethodError</span>
    <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_api-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(/_api)) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Provide information about API routes</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


327
328
329
330</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app.rb', line 327</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_api</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_api'>api</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_config-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(&quot;/_config&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get Nagios configuration hash form parsing main Nagios configuration file
nagios.cfg</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22
23</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/get/config.rb', line 20</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_config</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_configuration'>configuration</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_object_type-instance_method">
  
    - (<tt>Object</tt>) <strong>get_object_type</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get all objects of type :type</p>

<p><strong>Accepted output type modifiers:</strong></p>
<ul><li>
<p><code>/_list</code> : Short list of available objects, depending on the
current request context: hosts, services, etc.</p>
</li></ul>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>:type</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Type is one of Nagios objects like  hosts, hostgroupsroups, etc.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38
39
40
41
42
43
44
45
46</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/get/objects.rb', line 36</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_objects/:type</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_type'>type</span><span class='op'>|</span>
  <span class='kw'>begin</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@objects</span><span class='lbracket'>[</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span> <span class='kw'>if</span> <span class='ivar'>@output</span> <span class='op'>==</span> <span class='symbol'>:list</span>

  <span class='kw'>rescue</span> <span class='const'>NoMethodError</span>
    <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_objects-instance_method">
  
    - (<tt>Object</tt>) <strong>get_objects</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get full list of Nagios objects. Returns hash containing all configured
objects in Nagios: hosts, hostgroups, services, contacts. etc.</p>

<p><strong>Accepted output type modifiers:</strong></p>
<ul><li>
<p><code>/_list</code> : Short list of available objects, depending on the
current request context: hosts, services, etc.</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


16
17
18
19
20
21
22
23
24</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/get/objects.rb', line 16</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_objects</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>

  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='kw'>begin</span>
            <span class='ivar'>@output</span> <span class='op'>==</span> <span class='symbol'>:list</span> <span class='op'>?</span> <span class='ivar'>@objects</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span> <span class='op'>:</span> <span class='ivar'>@objects</span>
          <span class='kw'>rescue</span> <span class='const'>NoMethodError</span>
            <span class='kw'>nil</span>
          <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_runtime_config-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(/_runtime)) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Print out nagira runtime configuration</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


338
339
340
341
342
343
344
345
346
347
348
349
350</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app.rb', line 338</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_runtime</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>application:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='comma'>,</span>
    <span class='label'>version:</span> <span class='const'>VERSION</span><span class='comma'>,</span>
    <span class='label'>runtime:</span> <span class='lbrace'>{</span>
      <span class='label'>environment:</span> <span class='const'>Nagira</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_environment'>environment</span><span class='comma'>,</span>
      <span class='label'>home:</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HOME</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>user:</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>LOGNAME</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>nagiosFiles:</span> <span class='gvar'>$nagios</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span>  <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='lbrace'>{</span>  <span class='id identifier rubyid_x'>x</span> <span class='op'>=&gt;</span>  <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='id identifier rubyid_x'>x</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span> <span class='rbrace'>}</span><span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_slash-instance_method">
  
    - (<tt>Object</tt>) <strong>get</strong>(/)) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns application information: name, version, github repository.</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


356
357
358
359
360
361
362
363
364</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app.rb', line 356</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:application</span> <span class='op'>=&gt;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='comma'>,</span>
    <span class='symbol'>:version</span> <span class='op'>=&gt;</span> <span class='const'>VERSION</span><span class='comma'>,</span>
    <span class='symbol'>:source</span> <span class='op'>=&gt;</span> <span class='const'>GITHUB</span><span class='comma'>,</span>
    <span class='symbol'>:apiUrl</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\/$</span><span class='regexp_end'>/</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_api</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='rbrace'>}</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_status-instance_method">
  
    - (<tt>Object</tt>) <strong>get_status</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return all hosts status.</p>

<p>If no output modifier provided, outputs full hosttatus information for each
host. Not including services information. When <code>_full</code> modifier
is provided data include hoststatus, servicestatus and all comments
(servicecomments and hostcomments) for hosts.</p>

<p>Alias: get /_status is the same thing as get /_status/_hosts with
ActiveResource compatibility, i.e. for */_hosts request Nagira returns
array instead of hash.</p>

<p><strong>Accepted output type modifiers:</strong></p>
<ul><li>
<p><code>/_state</code> - Instead of full status information send only current
state. For hosts up/down, for services OK, Warn, Critical, Unknown
(0,1,2-1)</p>
</li><li>
<p><code>/_list</code> : Short list of available objects, depending on the
current request context: hosts, services, etc.</p>
</li><li>
<p><code>/_full</code> - Show full status information. When used in 
/_status/_full call will display full hoststaus and  servicestatus
information for each host.</p>
</li></ul>

<p>Support for (see API):</p>
<ul><li>
<p>plural resources: N/A</p>
</li><li>
<p>object access by ID: N/A</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/get/status.rb', line 137</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\/_status(\/_hosts)?$</span><span class='regexp_end'>/</span></span> <span class='kw'>do</span>

  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@status</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>

  <span class='kw'>case</span> <span class='ivar'>@output</span> 
  <span class='kw'>when</span> <span class='symbol'>:state</span>
    <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hoststatus</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>host_name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>current_state</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='symbol'>:list</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
  <span class='kw'>when</span> <span class='symbol'>:full</span>
    <span class='ivar'>@data</span>
  <span class='kw'>else</span>
    <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hoststatus</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_status_hostname-instance_method">
  
    - (<tt>Object</tt>) <strong>get_status_hostname</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Hoststatus for single host</p>

<p>Endpoint</p>
<ul><li>
<p>get “/_status/:hostname”</p>
</li></ul>

<p><strong>Accepted output type modifiers:</strong></p>
<ul><li>
<p><code>/_state</code> - Instead of full status information send only current
state. For hosts up/down, for services OK, Warn, Critical, Unknown
(0,1,2-1)</p>
</li></ul>

<p>Support for:</p>
<ul><li>
<p>plural resources: N/A</p>
</li><li>
<p>object access by ID: NO (TODO)</p>
</li></ul>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>:hostname</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Configured Nagios hostname</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174
175
176
177
178
179
180
181
182
183</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/get/status.rb', line 172</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>^/_status/(?&lt;hostname&gt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hostname_regex'>hostname_regex</span><span class='embexpr_end'>}</span><span class='tstring_content'>)$</span><span class='regexp_end'>}</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hostname'>hostname</span><span class='op'>|</span>


  <span class='id identifier rubyid_hostname'>hostname</span> <span class='op'>=</span> <span class='id identifier rubyid_hostname'>hostname</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='kw'>if</span> <span class='id identifier rubyid_hostname'>hostname</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\d+$</span><span class='regexp_end'>/</span></span>
  <span class='ivar'>@data</span> <span class='op'>=</span>  <span class='ivar'>@status</span><span class='lbracket'>[</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hoststatus</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span> <span class='kw'>if</span> <span class='ivar'>@status</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='id identifier rubyid_hostname'>hostname</span>
  
  <span class='kw'>if</span> <span class='ivar'>@output</span> <span class='op'>==</span> <span class='symbol'>:state</span>
    <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>host_name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>current_state</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_status_hostname_services-instance_method">
  
    - (<tt>Object</tt>) <strong>get_status_hostname_services</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Endpoints:</p>
<ul><li>
<p>GET /_status/:hostname/_services</p>
</li><li>
<p>GET /_status/:hostname/_hostcomments</p>
</li><li>
<p>GET /_status/:hostname/_servicecomments</p>
</li></ul>

<p>Read <code>services</code>, <code>hostcomments</code> or
<code>servicecomments</code> for single host.</p>

<p><strong>Accepted output type modifiers:</strong></p>
<ul><li>
<p><code>/_state</code> - Instead of full status information send only current
state. For hosts up/down, for services OK, Warn, Critical, Unknown
(0,1,2-1)</p>
</li><li>
<p><code>/_list</code> : Short list of available objects, depending on the
current request context: hosts, services, etc.</p>
</li><li>
<p><code>/_full</code> - Show full status information. When used in 
/_status/_full call will display full hoststaus and  servicestatus
information for each host.</p>
</li></ul>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>:hostname</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Configured Nagios hostname</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/get/status.rb', line 90</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>^/_status/(?&lt;hostname&gt;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hostname_regex'>hostname_regex</span><span class='embexpr_end'>}</span><span class='tstring_content'>)/_(?&lt;service&gt;(services|hostcomments|servicecomments))$</span><span class='regexp_end'>}</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hostname'>hostname</span><span class='comma'>,</span><span class='id identifier rubyid_service'>service</span><span class='op'>|</span>

  <span class='id identifier rubyid_hostname'>hostname</span> <span class='op'>=</span> <span class='id identifier rubyid_hostname'>hostname</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='kw'>if</span> <span class='id identifier rubyid_hostname'>hostname</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\d+$</span><span class='regexp_end'>/</span></span>
  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_service'>service</span>
        <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>services</span><span class='tstring_end'>&#39;</span></span> 
          <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>servicestatus</span><span class='tstring_end'>&#39;</span></span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_service'>service</span>
        <span class='kw'>end</span>
          
  <span class='kw'>if</span> <span class='ivar'>@status</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@status</span><span class='lbracket'>[</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rbracket'>]</span>
    <span class='kw'>case</span> <span class='ivar'>@output</span>
    <span class='kw'>when</span> <span class='symbol'>:list</span>
      <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@status</span><span class='lbracket'>[</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
    <span class='kw'>when</span> <span class='symbol'>:state</span>
      <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@status</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>host_name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>service_description</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>current_state</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@status</span><span class='lbracket'>[</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_status_hostname_services_service_name-instance_method">
  
    - (<tt>Object</tt>) <strong>get_status_hostname_services_service_name</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Full or short status information for single service on single host.</p>

<p><strong>Accepted output type modifiers:</strong></p>
<ul><li>
<p><code>/_state</code> - Instead of full status information send only current
state. For hosts up/down, for services OK, Warn, Critical, Unknown
(0,1,2-1)</p>
</li></ul>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>:hostname</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Configured Nagios hostname</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>:service_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Configured Nagios service for the host</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


61
62
63
64
65
66
67
68
69
70
71
72</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/get/status.rb', line 61</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_status/:hostname/_services/:service_name</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hostname'>hostname</span><span class='comma'>,</span><span class='id identifier rubyid_service'>service</span><span class='op'>|</span>

  <span class='id identifier rubyid_hostname'>hostname</span> <span class='op'>=</span> <span class='id identifier rubyid_hostname'>hostname</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='kw'>if</span> <span class='id identifier rubyid_hostname'>hostname</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\d+$</span><span class='regexp_end'>/</span></span>
  <span class='kw'>if</span> <span class='ivar'>@status</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@status</span><span class='lbracket'>[</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='ivar'>@output</span> <span class='op'>==</span> <span class='symbol'>:state</span>
      <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@status</span><span class='lbracket'>[</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>servicestatus</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_service'>service</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hostname</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>service_description</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>current_state</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='ivar'>@data</span> <span class='op'>=</span> <span class='ivar'>@status</span><span class='lbracket'>[</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>servicestatus</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_service'>service</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="object_not_found-instance_method">
  
    - (<tt>Object</tt>) <strong>after</strong>(&quot;Object not found or bad request&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>If result-set of object/status search is empty return HTTP 404 . This can
happen when you are requesting status for not existing host and/or service.</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


267
268
269
270
271
272
273
274
275</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app.rb', line 267</span>

<span class='id identifier rubyid_after'>after</span> <span class='kw'>do</span>
  <span class='kw'>if</span> <span class='op'>!</span> <span class='ivar'>@data</span> <span class='op'>||</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_halt'>halt</span> <span class='lbracket'>[</span><span class='int'>404</span><span class='comma'>,</span> <span class='lbrace'>{</span>
            <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Object not found or bad request</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
            <span class='symbol'>:error</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP::Notfound</span><span class='tstring_end'>&quot;</span></span>
          <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to_</span><span class='embexpr_beg'>#{</span><span class='ivar'>@format</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
         <span class='rbracket'>]</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_input_data-instance_method">
  
    - (<tt>Array</tt>) <strong>before</strong>(&quot;Parse PUT request body&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Process the data before on each HTTP request.</p>


  </div>
</div>
<div class="tags">
  
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>@input Sets @input instance variable.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


10
11
12
13
14
15
16
17
18
19
20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/put.rb', line 10</span>

<span class='id identifier rubyid_before'>before</span> <span class='kw'>do</span> 
  <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put?'>put?</span>
    <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
    <span class='ivar'>@input</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='ivar'>@format</span>
            <span class='kw'>when</span> <span class='symbol'>:json</span> <span class='kw'>then</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span>    <span class='id identifier rubyid_data'>data</span>
            <span class='kw'>when</span> <span class='symbol'>:xml</span>  <span class='kw'>then</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_from_xml'>from_xml</span> <span class='id identifier rubyid_data'>data</span>
            <span class='kw'>when</span> <span class='symbol'>:yaml</span> <span class='kw'>then</span> <span class='const'>YAML</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span>     <span class='id identifier rubyid_data'>data</span>
            <span class='kw'>end</span>
    <span class='comment'># Make sure we always return an Array
</span>    <span class='ivar'>@input</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='ivar'>@input</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='ivar'>@input</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Hash</span>
  <span class='kw'>end</span>
  <span class='ivar'>@input</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_nagios_files-instance_method">
  
    - (<tt>Object</tt>) <strong>before</strong>(&quot;Parse Nagios files&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Parse nagios files.</p>

<p>Note: *.parse methods are monkey-patched here (if you have required
&#39;lib/nagira&#39; above) to set min parsing interval to avoid file
paring on each HTTP request. File is parsed only if it was changed and if
it was parsed more then 60 (default) seconds ago. See
<code>lib/nagira/timed_parse.rb</code> for mor more info.</p>

<p>In development mode use files located under <code>./test/data</code>
directory. This allows to do development on the host where Nagios is
notinstalled. If you want to change this edit configuration in
config/environment.rb file.</p>

<p>See also comments in config/default.rb file regarding nagios_cfg,
status_cfg, objects_cfg.</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app.rb', line 126</span>

<span class='id identifier rubyid_before'>before</span> <span class='kw'>do</span>

  <span class='kw'>if</span> <span class='const'>Nagira</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_start_background_parser'>start_background_parser</span>
    <span class='kw'>unless</span> <span class='gvar'>$bg</span><span class='period'>.</span><span class='id identifier rubyid_alive?'>alive?</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Background Parser is configured to run, but is not active</span><span class='tstring_end'>&quot;</span></span>
      <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span>
      <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span>
      <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:objects</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span>
    <span class='kw'>end</span>
    <span class='gvar'>$use_inflight_status</span>  <span class='op'>?</span> <span class='ivar'>@status</span> <span class='op'>=</span> <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:status_inflight</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hosts</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
                          <span class='op'>:</span> <span class='ivar'>@status</span> <span class='op'>=</span> <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hosts</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='gvar'>$use_inflight_objects</span> <span class='op'>?</span> <span class='ivar'>@objects</span>  <span class='op'>=</span> <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:objects_inflight</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_objects'>objects</span>
                          <span class='op'>:</span> <span class='ivar'>@objects</span>  <span class='op'>=</span> <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:objects</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_objects'>objects</span>
  <span class='kw'>else</span>
    <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span>
    <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span>
    <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:objects</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span>
    <span class='ivar'>@status</span>   <span class='op'>=</span> <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hosts</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='ivar'>@objects</span>  <span class='op'>=</span> <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:objects</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_objects'>objects</span>
  <span class='kw'>end</span>


<span class='comment'>##
</span><span class='comment'># TODO: This stuff breaks XML valid. Will have to wait.
</span><span class='comment'>#
</span><span class='comment'>#     idx = 0
</span><span class='comment'>#     @status.keys.uniq.each do |hostname|
</span><span class='comment'>#       @status[idx] = @status[hostname]
</span><span class='comment'>#       idx += 1
</span><span class='comment'>#     end
</span>  <span class='comment'>#
</span>  <span class='comment'># Add plural keys to use ActiveResource with Nagira
</span>  <span class='comment'>#
</span>  <span class='ivar'>@objects</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_singular'>singular</span><span class='op'>|</span>
    <span class='ivar'>@objects</span><span class='lbracket'>[</span><span class='id identifier rubyid_singular'>singular</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_pluralize'>pluralize</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@objects</span><span class='lbracket'>[</span><span class='id identifier rubyid_singular'>singular</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="put__host_status_host_name-instance_method">
  
    - (<tt>Object</tt>) <strong>put</strong>(&quot;/_host_status/:host_name&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Same as /_status/:host_name (Not implemented)</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


47
48
49</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/put/host.rb', line 47</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_host_status/:host_name</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> 
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not implemented: TODO</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="put_status-instance_method">
  
    - (<tt>Object</tt>) <strong>put</strong>(&quot;/_status&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Submit JSON Hash for multiple services,  on multiple hosts.</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


10
11
12</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/put/host.rb', line 10</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_status</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TODO: Not implemented</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="put_status_as_http_parms-instance_method">
  
    - (<tt>Object</tt>) <strong>put</strong>(/_status/:host_name/_services/:service_description/_return_code/:return_code/_plugin_output/:plugin_output) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Update single service status on a single host. Use data provided in RESTful
path as parameters.</p>

<h2 id="label-Example">Example</h2>

<pre class="ruby"><span class="ruby-identifier">curl</span>  <span class="ruby-operator">-</span><span class="ruby-identifier">d</span> <span class="ruby-string">&quot;test data&quot;</span>    <span class="ruby-operator">-</span><span class="ruby-constant">X</span> <span class="ruby-constant">PUT</span> <span class="ruby-identifier">http</span>:<span class="ruby-operator">/</span><span class="ruby-regexp">/localhost:4567/</span><span class="ruby-identifier">_status</span><span class="ruby-operator">/</span><span class="ruby-identifier">viy</span><span class="ruby-operator">/</span><span class="ruby-identifier">_services</span><span class="ruby-operator">/</span><span class="ruby-constant">PING</span><span class="ruby-operator">/</span><span class="ruby-identifier">_return_code</span><span class="ruby-operator">/</span><span class="ruby-value">0</span><span class="ruby-operator">/</span><span class="ruby-identifier">_plugin_output</span><span class="ruby-operator">/</span><span class="ruby-constant">OK</span>
 <span class="ruby-comment"># =&gt; ok</span>
</pre>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


93
94
95
96</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/put/status.rb', line 93</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_status/:host_name/_services/:service_description/_return_code/:return_code/_plugin_output/:plugin_output</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> 
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='id identifier rubyid_update_service_status'>update_service_status</span> <span class='id identifier rubyid_params'>params</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="put_status_host_name-instance_method">
  
    - (<tt>Object</tt>) <strong>put</strong>(&quot;/_status/:host_name&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Update hoststatus information only for the given host. URL hostname always
override hostname given in the JSON file.</p>

<h2 id="label-Example">Example</h2>

<pre class="ruby">$ <span class="ruby-identifier">curl</span> <span class="ruby-operator">-</span><span class="ruby-identifier">i</span> <span class="ruby-operator">-</span><span class="ruby-constant">H</span> <span class="ruby-string">&quot;Accept: application/json&quot;</span> <span class="ruby-operator">-</span><span class="ruby-identifier">d</span> <span class="ruby-ivar">@host</span>.<span class="ruby-identifier">json</span> <span class="ruby-operator">-</span><span class="ruby-constant">X</span>
    <span class="ruby-constant">PUT</span> <span class="ruby-identifier">http</span>:<span class="ruby-operator">/</span><span class="ruby-regexp">/localhost:4567/</span><span class="ruby-identifier">_status</span><span class="ruby-operator">/</span><span class="ruby-identifier">svaroh</span>

  =<span class="ruby-operator">&gt;</span> {<span class="ruby-string">&quot;result&quot;</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>, <span class="ruby-string">&quot;object&quot;</span><span class="ruby-operator">:</span> [{<span class="ruby-string">&quot;data&quot;</span><span class="ruby-operator">:</span> {<span class="ruby-string">&quot;host_name&quot;</span><span class="ruby-operator">:</span><span class="ruby-string">&quot;svaroh&quot;</span>,
  <span class="ruby-string">&quot;status_code&quot;</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;0&quot;</span>, <span class="ruby-string">&quot;plugin_output&quot;</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;ping OK&quot;</span>, <span class="ruby-string">&quot;action&quot;</span><span class="ruby-operator">:</span>
  <span class="ruby-string">&quot;PROCESS_HOST_CHECK_RESULT&quot;</span>}, <span class="ruby-string">&quot;result&quot;</span><span class="ruby-operator">:</span><span class="ruby-keyword">true</span>, <span class="ruby-string">&quot;messages&quot;</span><span class="ruby-operator">:</span> []}]}
</pre>

<h2 id="label-Example+JSON">Example JSON</h2>

<pre class="code ruby"><code class="ruby">{
 &quot;status_code&quot;:&quot;0&quot;,
 &quot;plugin_output&quot; : &quot;ping OK&quot;
}</code></pre>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


35
36
37
38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/put/host.rb', line 35</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_status/:host_name</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='id identifier rubyid_update_host_status'>update_host_status</span> <span class='ivar'>@input</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='lbrace'>{</span>
                                                  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>host_name</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>host_name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
                                                <span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="put_status_host_name_services-instance_method">
  
    - (<tt>Object</tt>) <strong>put</strong>(&quot;/_status/:host_name/_services&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Update multiple services on the same host.</p>

<p>Hostname from URL always overrides host_name if it&#39;s is provided in the
JSON data.</p>

<h2 id="label-Example+return+JSON+data">Example return JSON data</h2>

<pre class="ruby">$ <span class="ruby-identifier">curl</span> <span class="ruby-operator">-</span><span class="ruby-identifier">i</span> <span class="ruby-operator">-</span><span class="ruby-constant">H</span> <span class="ruby-string">&quot;Accept: application/json&quot;</span> <span class="ruby-operator">-</span><span class="ruby-identifier">d</span> <span class="ruby-ivar">@dat_m</span>.<span class="ruby-identifier">json</span> <span class="ruby-operator">-</span><span class="ruby-constant">X</span> <span class="ruby-constant">PUT</span>
<span class="ruby-identifier">http</span>:<span class="ruby-operator">/</span><span class="ruby-regexp">/localhost:4567/</span><span class="ruby-identifier">_status</span><span class="ruby-operator">/</span><span class="ruby-identifier">svaroh</span><span class="ruby-operator">/</span><span class="ruby-identifier">_services</span>

  {<span class="ruby-string">&quot;result&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>,
   <span class="ruby-string">&quot;object&quot;</span>=<span class="ruby-operator">&gt;</span>
    [{<span class="ruby-string">&quot;data&quot;</span>=<span class="ruby-operator">&gt;</span>
       {<span class="ruby-string">&quot;return_code&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>,
        <span class="ruby-string">&quot;plugin_output&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;All OK&quot;</span>,
        <span class="ruby-string">&quot;service_description&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;PING&quot;</span>,
        <span class="ruby-string">&quot;host_name&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;archive&quot;</span>,
        <span class="ruby-string">&quot;action&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;PROCESS_SERVICE_CHECK_RESULT&quot;</span>},
      <span class="ruby-string">&quot;result&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-keyword">true</span>,
      <span class="ruby-string">&quot;messages&quot;</span>=<span class="ruby-operator">&gt;</span>[]}]}
</pre>

<h2 id="label-Example+JSON+for+submit">Example JSON for submit</h2>

<p>All attributes provided in the example below are requried for host service
status information:</p>
<ul><li>
<p>host_name</p>
</li><li>
<p>service_description</p>
</li><li>
<p>return_code</p>
</li><li>
<p>plugin_output</p>

<pre class="code ruby"><code class="ruby">[{ &quot;host_name&quot;:&quot;viy&quot;,
   &quot;service_description&quot;:&quot;PING&quot;,
   &quot;return_code&quot;:&quot;0&quot;,
   &quot;plugin_output&quot;:&quot;64 bytes from 127.0.0.1: icmp_seq=0 ttl=64 time=0.046 ms &quot;
  },

{&quot;host_name&quot;:&quot;svaroh&quot;,
   &quot;service_description&quot;:&quot;Apache&quot;,
   &quot;return_code&quot;:&quot;2&quot;,
   &quot;plugin_output&quot;:&quot;HTTP GEt failed&quot;
   }
  ]</code></pre>
</li></ul>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/put/status.rb', line 54</span>

<span class='id identifier rubyid_put'>put</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/_status/:host_name/_services</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>

  <span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='kw'>true</span>

  <span class='ivar'>@input</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_datum'>datum</span><span class='op'>|</span>
    <span class='comment'># FIXME - this calls update for each service. Should be batching them together
</span>    <span class='id identifier rubyid_update'>update</span> <span class='op'>=</span> <span class='id identifier rubyid_update_service_status'>update_service_status</span><span class='lparen'>(</span>
                                    <span class='id identifier rubyid_datum'>datum</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='lbrace'>{</span> 
                                                  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>host_name</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>host_name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
                                                <span class='rbrace'>}</span><span class='rparen'>)</span>
                                    <span class='rparen'>)</span>
    <span class='id identifier rubyid_data'>data</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_update'>update</span><span class='lbracket'>[</span><span class='symbol'>:object</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>&amp;&amp;=</span> <span class='id identifier rubyid_update'>update</span><span class='lbracket'>[</span><span class='symbol'>:result</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='ivar'>@data</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>result:</span> <span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='label'>object:</span> <span class='id identifier rubyid_data'>data</span> <span class='rbrace'>}</span>
  <span class='kw'>nil</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="return_jsonp_data-instance_method">
  
    - (<tt>Object</tt>) <strong>after</strong>(&quot;Return formatted data&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>If it&#39;s a JSON-P request, return its data with prepended @callback
function name. JSONP request is detected by <code>before</code> method.</p>

<p>If no callback paramete given, then simply return formatted data as XML,
JSON, or YAML in response body.</p>

<h1 id="label-Example">Example</h1>

<pre class="code ruby"><code class="ruby"></code></pre>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


314
315
316</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app.rb', line 314</span>

<span class='id identifier rubyid_after'>after</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_body'>body</span><span class='lparen'>(</span> <span class='ivar'>@callback</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@callback</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='ivar'>@data</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to_</span><span class='embexpr_beg'>#{</span><span class='ivar'>@format</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="startup_configuration-instance_method">
  
    - (<tt>Object</tt>) <strong>before</strong>(&quot;Initial Config&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Do some necessary tasks at start and then run Sinatra app.</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app.rb', line 62</span>

<span class='id identifier rubyid_configure'>configure</span> <span class='kw'>do</span>

  <span class='gvar'>$nagios</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='rbrace'>}</span>
  <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span>  <span class='op'>=</span> <span class='const'>Nagios</span><span class='op'>::</span><span class='const'>Config</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='const'>Nagira</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_nagios_cfg'>nagios_cfg</span>
  <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span>

  <span class='gvar'>$nagios</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='lbrace'>{</span>
                  <span class='label'>status:</span> <span class='const'>Nagios</span><span class='op'>::</span><span class='const'>Status</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>  <span class='const'>Nagira</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_status_cfg'>status_cfg</span> <span class='op'>||</span>
                                               <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_status_file'>status_file</span>
                                               <span class='rparen'>)</span><span class='comma'>,</span>
                  <span class='label'>objects:</span> <span class='const'>Nagios</span><span class='op'>::</span><span class='const'>Objects</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='const'>Nagira</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_objects_cfg'>objects_cfg</span> <span class='op'>||</span>
                                                <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_object_cache_file'>object_cache_file</span>
                                                <span class='rparen'>)</span><span class='comma'>,</span>
                  <span class='label'>commands:</span> <span class='const'>Nagios</span><span class='op'>::</span><span class='const'>ExternalCommands</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='const'>Nagira</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_command_file'>command_file</span> <span class='op'>||</span>
                                                          <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_command_file'>command_file</span>
                                                          <span class='rparen'>)</span>
                <span class='rbrace'>}</span><span class='rparen'>)</span>

  <span class='gvar'>$nagios</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='lbrace'>{</span>
                  <span class='label'>status_inflight:</span> <span class='const'>Nagios</span><span class='op'>::</span><span class='const'>Status</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='const'>Nagira</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_status_cfg'>status_cfg</span> <span class='op'>||</span>
                                                       <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_status_file'>status_file</span>
                                                       <span class='rparen'>)</span><span class='comma'>,</span>
                  <span class='label'>objects_inflight:</span> <span class='const'>Nagios</span><span class='op'>::</span><span class='const'>Objects</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span> <span class='const'>Nagira</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_objects_cfg'>objects_cfg</span> <span class='op'>||</span>
                                                         <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:config</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_object_cache_file'>object_cache_file</span>
                                                       <span class='rparen'>)</span>
                <span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='op'>::</span><span class='const'>DEFAULT</span><span class='lbracket'>[</span><span class='symbol'>:start_background_parser</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='embexpr_end'>}</span><span class='tstring_content'>] -- Starting Nagira application</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='embexpr_end'>}</span><span class='tstring_content'>] -- Version </span><span class='embexpr_beg'>#{</span><span class='const'>Nagira</span><span class='op'>::</span><span class='const'>VERSION</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='embexpr_end'>}</span><span class='tstring_content'>] -- Running in </span><span class='embexpr_beg'>#{</span><span class='const'>Nagira</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_environment'>environment</span><span class='embexpr_end'>}</span><span class='tstring_content'> environment</span><span class='tstring_end'>&quot;</span></span>
  <span class='gvar'>$nagios</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='embexpr_end'>}</span><span class='tstring_content'>] -- Using nagios </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x'>x</span><span class='embexpr_end'>}</span><span class='tstring_content'> file: </span><span class='embexpr_beg'>#{</span><span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='id identifier rubyid_x'>x</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span>
  <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:objects</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span>

  <span class='ivar'>@status</span>   <span class='op'>=</span> <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hosts</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@objects</span>  <span class='op'>=</span> <span class='gvar'>$nagios</span><span class='lbracket'>[</span><span class='symbol'>:objects</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_objects'>objects</span>

  <span class='const'>Nagios</span><span class='op'>::</span><span class='const'>BackgroundParser</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="strip_extensions-instance_method">
  
    - (<tt>Object</tt>) <strong>before</strong>(&quot;detect format&quot;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Detect and strip output format extension</p>

<p>Strip extension (@format) from HTTP route and set it as instance variable
@format. Valid formats are .xml, .json, .yaml. If format is not specified,
it is set to default format (Nagira.settings.format).</p>

<p>@format can be assigned one of the symbols: :xml, :json, :yaml.</p>

<h1 id="label-Examples">Examples</h1>

<pre class="ruby"><span class="ruby-constant">GET</span> <span class="ruby-node">/_objects              # =&gt; default format
GET /</span><span class="ruby-identifier">_objects</span>.<span class="ruby-identifier">json</span>         <span class="ruby-comment"># =&gt; :json</span>
<span class="ruby-constant">GET</span> <span class="ruby-regexp">/_status/</span><span class="ruby-identifier">_list</span>.<span class="ruby-identifier">yaml</span>    <span class="ruby-comment"># =&gt; :yaml</span>
</pre>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


195
196
197
198
199</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app.rb', line 195</span>

<span class='id identifier rubyid_before'>before</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path_info'>path_info</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_format_extensions'>format_extensions</span><span class='embexpr_end'>}</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@format</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='backref'>$1</span> <span class='op'>||</span> <span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_format'>format</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>application/</span><span class='embexpr_beg'>#{</span><span class='ivar'>@format</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="strip_output_type-instance_method">
  
    - (<tt>Object</tt>) <strong>before</strong>(&#39;detect output mode&#39;) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Detect output mode modifier</p>

<p>Detect and strip output type from HTTP route. Full list of output types is
<code>:list</code>, <code>:state</code> or <code>:full</code>,
corresponding to (+/list, <code>/state</code>, <code>/full</code> routes).</p>

<p>Output type defined by route modifier appended to the end of HTTP route. If
no output type specfied it is set to <code>:full</code>. Output mode can be
followed by format extension (<code>.json</code>, <code>.xml</code> or
<code>.yaml</code>).</p>

<h1 id="label-Examples">Examples</h1>

<pre class="ruby"><span class="ruby-constant">GET</span> <span class="ruby-regexp">/_objects/</span><span class="ruby-identifier">_list</span>     <span class="ruby-comment"># =&gt; :list</span>
<span class="ruby-constant">GET</span> <span class="ruby-regexp">/_status/</span><span class="ruby-identifier">_state</span>     <span class="ruby-comment"># =&gt; :state</span>
<span class="ruby-constant">GET</span> <span class="ruby-regexp">/_status/</span><span class="ruby-operator">:</span><span class="ruby-identifier">hostname</span>  <span class="ruby-comment"># =&gt; :full</span>
<span class="ruby-constant">GET</span> <span class="ruby-node">/_status            # =&gt; :normal
</span></pre>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


229
230
231
232</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app.rb', line 229</span>

<span class='id identifier rubyid_before'>before</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path_info'>path_info</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\/_(list|state|full)$</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@output</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='backref'>$1</span> <span class='op'>||</span> <span class='symbol'>:normal</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_host_status-instance_method">
  
    - (<tt>Object</tt>) <strong>update_host_status</strong>(params) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Small helper to submit data to ::Nagios::ExternalCommands object. For host
status updates sends external command via ::Nagios::ExternalCommands.write
method.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/put.rb', line 49</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_host_status'>update_host_status</span> <span class='id identifier rubyid_params'>params</span>
  <span class='id identifier rubyid_put_update'>put_update</span> <span class='symbol'>:PROCESS_HOST_CHECK_RESULT</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_service_status-instance_method">
  
    - (<tt>Object</tt>) <strong>update_service_status</strong>(params) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Small helper to submit data to ::Nagios::ExternalCommands object. For
status updates sends external coond via ::Nagios::ExternalCommands.send
method.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/app/routes/put.rb', line 42</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_service_status'>update_service_status</span> <span class='id identifier rubyid_params'>params</span>
  <span class='id identifier rubyid_put_update'>put_update</span> <span class='symbol'>:PROCESS_SERVICE_CHECK_RESULT</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri Aug 30 19:00:57 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7 (ruby-2.0.0).
</div>

  </body>
</html>