<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="revisit-after" content="30 days"><meta name="robots" content="index, follow"><title>Nagios Checks Aggregation | monitoring | nagios | nagira | Dmytro Kovalov</title><meta name="description" content="Nagira — RESTful API for Nagios — simplifies Nagios checks aggregation
"><meta name="keywords" content="monitoring,nagios,nagira,RESTful API,ruby"/><meta name="revised" content="Dmytro Kovalov,  2012/12/14"/><meta name="author" content="Dmytro Kovalov"/><link rel="icon" href="/images/favicon.ico"><link href='http://fonts.googleapis.com/css?family=Noto+Sans&subset=latin,cyrillic-ext' rel='stylesheet' type='text/css'><link href='http://fonts.googleapis.com/css?family=Seymour+One&subset=latin,cyrillic' rel='stylesheet' type='text/css'><link href='http://fonts.googleapis.com/css?family=Comfortaa&subset=latin,cyrillic-ext' rel='stylesheet' type='text/css'><link href='http://fonts.googleapis.com/css?family=Lobster&subset=latin,cyrillic-ext' rel='stylesheet' type='text/css'><link href='http://fonts.googleapis.com/css?family=Inconsolata:700' rel='stylesheet' type='text/css'><link rel="stylesheet" href="/assets/app-82ce0949d155ea291616edf1af09b33e.css"> <script src="/assets/app-b80c4942bb62b4e63380a8693c39923c.js"></script><meta name="thefeedbackbutton" content="Github:ed4d541b3268b2dc5250684b57864d"> <script src="http://www.thefeedbackbutton.com/button.js"></script><style>#TheFeedbackButton{top:270px !important}</style><script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-33505287-1"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><meta name="google-translate-customization" content="e5305daecdf84461-c504f9bf5024d6b1-gef663547868bd15e-10"></meta></head><body><div id="fb-root"></div> <script>!function(e,t,n){var c,o=e.getElementsByTagName(t)[0];e.getElementById(n)||(c=e.createElement(t),c.id=n,c.src="//connect.facebook.net/en_US/all.js#xfbml=1",o.parentNode.insertBefore(c,o))}(document,"script","facebook-jssdk")</script> <script>!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://apis.google.com/js/plusone.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><a href="https://github.com/dmytro/nagira"> <img id="ribbon" src="http://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"/></a><div id="tiki-top"><table style="margin:0;padding:0" cellspacing="0" cellpadding="0" width="100%" columns="3"><tbody><tr style="padding:0;margin:0"><td style="width:120px;background-color:#D9A005;color:#8b0b04;font-wight:bold;text-align:right;padding:1em;padding-top:2em;border:0;border-right:10px solid #000"><p class="motto plus">Лупайте сю скалу...</p><p class='motto'>Іван Франко</p></td><td style="border:0"> <a href="http://yarylo.sytes.net/"><img align="right" border="0" src="/images/yarylo.png"></a> <br clear="all"><div id="top_bar_title"> <a href="http://yarylo.sytes.net/dmytro" style="color:#8B0B04">Уроки пані Маєш</a></div><div style="float:left"><div class="fb-like" data-send="false" data-layout="button_count" data-width="450" data-show-faces="true"></div><div align="right" class="g-plusone" data-size="medium"></div></div><div style="float:right;padding:5px"><div ><img height="14" width="14" src="/images/feed-icon-14x14.png"> <a href="rss.xml">RSS</a> | <a href="atom.xml">Atom</a></div></div></td><td style="border:0;border-left:10px solid #000;width:200px;background-color:#8B0B04"><p class="editdate" style="font-size:small;color:#D9A005;margin:5px;margin-top:100px;margin-right:80px"> 15 December 2013</p></td></tr></tbody></table></div><div id="tiki-mid"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td id="leftcolumn"><p id="preamble"><a class="top" href="/"><h1>TOP »</h1></a><p><a name="tags"></a><div id='tag_cloud'> <a href="/tags.html#mac" title="mac" rel="7">mac</a> <a href="/tags.html#history" title="history" rel="7">history</a> <a href="/tags.html#solaris" title="solaris" rel="1">solaris</a> <a href="/tags.html#email" title="email" rel="2">email</a> <a href="/tags.html#sendmail" title="sendmail" rel="1">sendmail</a> <a href="/tags.html#cli" title="cli" rel="7">cli</a> <a href="/tags.html#nfs" title="nfs" rel="1">nfs</a> <a href="/tags.html#configuration" title="configuration" rel="15">configuration</a> <a href="/tags.html#interesting" title="interesting" rel="1">interesting</a> <a href="/tags.html#linux" title="linux" rel="6">linux</a> <a href="/tags.html#debian" title="debian" rel="4">debian</a> <a href="/tags.html#xwindow" title="xwindow" rel="1">xwindow</a> <a href="/tags.html#css" title="css" rel="4">css</a> <a href="/tags.html#disk" title="disk" rel="1">disk</a> <a href="/tags.html#books" title="books" rel="1">books</a> <a href="/tags.html#fun" title="fun" rel="1">fun</a> <a href="/tags.html#cobbler" title="cobbler" rel="1">cobbler</a> <a href="/tags.html#installation" title="installation" rel="3">installation</a> <a href="/tags.html#troubleshooting" title="troubleshooting" rel="2">troubleshooting</a> <a href="/tags.html#ntp" title="ntp" rel="1">ntp</a> <a href="/tags.html#environment" title="environment" rel="3">environment</a> <a href="/tags.html#perl" title="perl" rel="1">perl</a> <a href="/tags.html#request tracker" title="request tracker" rel="2">request tracker</a> <a href="/tags.html#ruby" title="ruby" rel="12">ruby</a> <a href="/tags.html#development" title="development" rel="5">development</a> <a href="/tags.html#gem" title="gem" rel="1">gem</a> <a href="/tags.html#nagios" title="nagios" rel="4">nagios</a> <a href="/tags.html#monitoring" title="monitoring" rel="4">monitoring</a> <a href="/tags.html#nagira" title="nagira" rel="4">nagira</a> <a href="/tags.html#ssh" title="ssh" rel="1">ssh</a> <a href="/tags.html#tmux" title="tmux" rel="2">tmux</a> <a href="/tags.html#tips" title="tips" rel="8">tips</a> <a href="/tags.html#unix" title="unix" rel="3">unix</a> <a href="/tags.html#shell" title="shell" rel="3">shell</a> <a href="/tags.html#zsh" title="zsh" rel="1">zsh</a> <a href="/tags.html#prompt" title="prompt" rel="1">prompt</a> <a href="/tags.html#RESTful API" title="RESTful API" rel="3">RESTful API</a> <a href="/tags.html#blog" title="blog" rel="3">blog</a> <a href="/tags.html#github" title="github" rel="3">github</a> <a href="/tags.html#jekyll" title="jekyll" rel="3">jekyll</a> <a href="/tags.html#chef" title="chef" rel="3">chef</a> <a href="/tags.html#capistrano" title="capistrano" rel="3">capistrano</a> <a href="/tags.html#deployment" title="deployment" rel="3">deployment</a> <a href="/tags.html#Japan" title="Japan" rel="13">Japan</a> <a href="/tags.html#Ukrainian" title="Ukrainian" rel="13">Ukrainian</a> <a href="/tags.html#travel" title="travel" rel="13">travel</a> <a href="/tags.html#culture" title="culture" rel="4">culture</a></div></p><h1 class="even">Selected projects <a style="float:right" href="/github.html"><b>See all » </b></a></h1><a href="/aws-deploy.html">AWS Deploy</a><a href="/banalize.html">Banalize: Bash static code analyzer</a><a href="/dbi-report-excel.html">DBIx::Report::Excel</a><a href="/dotfiles/index.html">Shell settings, AKA dotfiles</a><a href="/github_keys/index.html">Github keys</a><a href="/nagios_couchbase.html">Nagios Monitoring for Couchbase server</a><a href="/nagira/index.html">Nagira: RESTful API for Nagios</a><a href="/rfb.html">Ready For Business Automation system</a><a href="/rspec_normalized_hash/index.html">RSpec tests for Normalized Hash</a><a href="/Web-iPhoto/index.html">Web iPhoto</a><a name="blog"></a><h1>Blog <a style="float:right" href="/posts.html"><b>All posts » </b></a></h1> <a href="/series/Lito_na_pivnochi_YAponiyi.html"> Series: Літо на півночі Японії</a><a href="/2013/12/04/running_chef_roles_from_capistrano.html">Running Chef roles from Capistrano </a><a href="/2013/11/01/chef_and_capistrano_integration.html">und Capiche </a><a href="/2013/10/29/optimizing_jekyll.html">Github & Jekyll: Speeding up Jekyll site</a><a href="/2013/08/13/more_about_jekyll.html">Github & Jekyll: More experience with Jekyll and setup changes</a><a href="/2013/05/21/easy_spawn_new_hosts_with_capistrano.html">Build new hosts with Capistrano and Chef </a><a href="/2013/05/15/custom_css_for_rt4.html">Request Tracker: More about custom CSS for RT4</a><a href="/2013/03/18/ruby_2_test_drive.html">Ruby 2 test drive </a><a href="/2013/03/15/nagira_v0.2.5_release.html">Nagira v0.2.5 release </a><a href="/2013/03/13/its_unix_my_dear_watson.html">It's UNIX my dear Watson </a><a href="/2013/01/08/memorizable_password_generation.html">Memorizable password generation </a><a href="/2012/12/22/jekyll-tags-pygmnents.html">Github & Jekyll: New tricks and questions with Jekyll</a><h1 class="even">Slides <a style="float:right" href="/presentations"><b>See all » </b></a></h1> <a href=/ presentations/ nagira_tlug. html>Nagira @TLUG, 2012</a><a href=/ presentations/ rspec_and_guard. html>Rspec and Guard</a><a name="about"></a><h1>About</h1><a href="http://uk.wikipedia.org/wiki/%D0%AF%D1%80%D0%B8%D0%BB%D0%BE">Ярило</a> <a href="https://en.wikipedia.org/wiki/Jarilo">Yarylo, Jarilo</a> <a href="http://github.com/dmytro">me @ github</a> <a href="http://search.cpan.org/~dmytro">me @ CPAN</a> <a href="http://tinyurl.com/7j89dhl"> Dmytro (CV)</a><p><p></td><td id="centercolumn"><div class="wikitext"><div class="titlebar"> Nagios Checks Aggregation<div style="float:right;padding-right:10px" id="google_translate_element"></div><script>function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"en",includedLanguages:"en,ja,uk",layout:google.translate.TranslateElement.InlineLayout.SIMPLE,multilanguagePage:!0,gaTrack:!0,gaId:"UA-33505287-1"},"google_translate_element")}</script><script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script></div><div id="related"> <script>function createTOC(a,t){var e=0,h=$("<ul id='bookmarksList'>");$("#content").children(a).each(function(){$(this).html("<a name='bookmark"+e+"'></a>"+$(this).html()),h.append($("<li class='"+this.nodeName+"'><a href='#bookmark"+e++ +"'>"+$(this).text()+"</a></li>"))}),$("#"+t).append(h)}$("document").ready(function(){createTOC("h1,h2,h3,h4,h5,h6","TOC   ")})</script><style>#TOC.bookmarkList li{list-style-type:none}li:first-child{text-indent:0}.H1,.H2,.H3,.H4,.H5,.H6{display:block}.H1{text-indent:0;font-size:100%}.H2{text-indent:2ex;font-size:90%}.H3{text-indent:4ex;font-size:80%}.H4{text-indent:6ex;font-size:70%}.H5{text-indent:8ex;font-size:60%}.H6{text-indent:10ex;font-size:50%}</style><strong id="toc_title">Table Of Contents</strong><div id="TOC"></div><h3>Related Posts</h3><ul class="posts"><li class="blog-toc-item"><a href="/2013/03/15/nagira_v0.2.5_release.html">Nagira v0.2.5 release</a></li><li class="blog-toc-item"><a href="/2012/12/12/monitoring-patterns-I.html">Monitoring Applications with RESTful API</a></li><li class="blog-toc-item"><a href="/2012/10/11/nagira-concert.html">What's in the name -- Nagira?</a></li><li class="blog-toc-item"><a href="/2013/12/04/running_chef_roles_from_capistrano.html">Running Chef roles from Capistrano</a></li><li class="blog-toc-item"><a href="/2013/11/01/chef_and_capistrano_integration.html">und Capiche</a></li></ul><p><h3>Tags</h3>: <a href="/tags.html#monitoring">monitoring</a> : <a href="/tags.html#nagios">nagios</a> : <a href="/tags.html#nagira">nagira</a> : <a href="/tags.html#RESTful API">RESTful API</a> : <a href="/tags.html#ruby">ruby</a> :</p><div id="series"><hr class="thin"><div class="seriesNote"><div class="italic"> This article is Part 2 in a 2-Part Series.</div> <a href="/series/Monitoring_patterns_for_Nagios_with_Nagira_API.html"><h3>Monitoring patterns for Nagios with Nagira API (See all »)</h3></a><div class="small" style="display:block">Part 1 - <a href="/2012/12/12/monitoring-patterns-I.html">Monitoring Applications with RESTful API</a></div><div class="small" style="display:block">Part 2 - This article</div></div></div></div><div id="content"><p class='italic'><b>Summary:</b> Reviewed several patterns for integrated monitoring with Nagios and Nagira . Nagira — RESTful API for Nagios — simplifies Nagios checks aggregation . For second part of the series an easy way of combining several Nagios results into aggregated check is presented.</p><h1>Nagios Checks Aggregation</h1><p>This kind of setup is applicable in situations where there is a need to integrate several already existing Nagios checks, but you need to aggregate information from checks into combined metric. In this case all necessary information already exists in Nagios, there is no need to read it from monitored devices, API can fetch source information from Nagios status store and write back calculated output. See diagram below.</p><p><img src="/images/2012-12-14-nagira_nagios_checks_aggregation_flow.png" alt="Simplified diagram"/></p><h2>Computer Rack Prower Monitoring</h2><p>An example of such setup is an electric current monitoring system.</p><p>Electric current of the power lines in a computer rack are monitored by Nagios. Information from power lines is collected by SNMP. Computer racks have two power inputs for redundancy; servers, having similarly two redundant power supplies each, are connected to both power inputs.</p><p>However, additional requirement exist for monitoring gross current consumed by each rack. For example, in the case of one side power source failure, the whole rack power can fail if sum total of currents is higher than power limit for the remaining source — even if each of the power lines before the failure is in a green zone.</p><p>In this case, to obtain data for the pair of power sources, data of each individual line is read from Nagios status database, instead of using SNMP. Data processed by script, and if total gross current of two power lines is greater than current limit for single line, status is marked as WARNING or CRITICAL. Resulting combined metric (sum of two currents) is written back to Nagios together with RAG status. All communication — reads and writes — are done only using web-services Nagira API.</p><h2>Possible uses</h2><p>Other examples where such kind of setup can be applied are:</p><ul><li>load balanced or DNS round-robin farm of web servers, to monitor total network traffic, not only traffic on individual servers;</li><li>status of clustered application — if it is known, for example, that application execution requires <code>X</code> number of servers with <code>Y</code> CPU cores, each occupied by <code>Z%</code>.</li></ul><h1>See more</h1><ul><li><a href="http://nagios.sourceforge.net/docs/3_0/extcommands.html">Nagios External Commands interface</a></li><li><a href="/2012/12/12/monitoring-patterns-I.html">Monitoring patterns for Nagios with Nagira API - Part I</a></li><li><a href="http://dmytro.github.com/nagira/doc">Nagira Documentation</a></li></ul><h2> Author</h2><p> Dmytro Kovalov (<a href="mailto:dmytro.kovalov@gmail.com">dmytro.kovalov@gmail.com</a>)</p><div class="download"><h2>Source code</h2><div class="download links"> <a href="https://github.com/dmytro/nagira/zipball/master"><img border="0" src="https://github.com/images/modules/download/zip.png"></a><a href="https://github.com/dmytro/nagira/tarball/master"><img border="0" src="https://github.com/images/modules/download/tar.png"></a></div><ul><li>Download nagira in either zip or tar formats ⇒<li>Clone nagira with <a href="http://git-scm.com">git</a> <pre> $ git clone git://github.com/dmytro/nagira</pre><li>or go to <a href="http://github.com/dmytro/nagira">nagira's Github repository »</a></ul></div></div><hr><div id="blog-toc"><div class="toc-title">More Posts</div> <span class="blog-toc-item"><a href="/2013/12/04/running_chef_roles_from_capistrano.html">Running Chef roles from Capistrano</a></span>| <span class="blog-toc-item"><a href="/2013/11/01/chef_and_capistrano_integration.html">und Capiche</a></span>| <span class="blog-toc-item"><a href="/2013/10/29/optimizing_jekyll.html">Speeding up Jekyll site</a></span>| <span class="blog-toc-item"><a href="/2013/08/13/more_about_jekyll.html">More experience with Jekyll and setup changes</a></span>| <span class="blog-toc-item"><a href="/2013/08/01/back_home.html">День останній: два роки після цунамі</a></span>| <span class="blog-toc-item"><a href="/2013/07/31/ryusendo.html">Джерело Дракона, Рюсендо</a></span>| <span class="blog-toc-item"><a href="/2013/07/31/hachimantai.html">День десятий: вулкани і болота Хачімантаю</a></span>| <span class="blog-toc-item"><a href="/2013/07/30/tsuruno_onsen.html">Екстремальна екзотика в Цуруно онсен</a></span>| <span class="blog-toc-item"><a href="/2013/07/29/day_8_tazawako.html">День восьмий: Найглибше озеро Японії</a></span>| <span class="blog-toc-item"><a href="/2013/07/29/day_4_chusonji.html">День четвертий: багато буддистських святинь</a></span>| <span class="blog-toc-item"><a href="/2013/07/25/day_5to7_tokoton_yama_IV.html">Токотон-яма (IV). Пекло.</a></span>| <span class="blog-toc-item"><a href="/2013/07/25/day_5to7_tokoton_yama_III.html">Токотон-яма (III). Каньйон з гейзерами.</a></span>| <span class="blog-toc-item"><a href="/2013/07/25/day_5to7_tokoton_yama_II.html">Автокемпінг Токотон-яма (II)</a></span>| <span class="blog-toc-item"><a href="/2013/07/25/day_5to7_tokoton_yama_I.html">Три дні в Токотон-яма (I). Сукава онсен.</a></span>| <span class="blog-toc-item"><a href="/2013/07/24/day_three_yamadera.html">День третій: Окама і Ямадера</a></span>| <span class="blog-toc-item"><a href="/2013/07/23/druhyi_den.html">Другий день</a></span>| <span class="blog-toc-item"><a href="/2013/07/22/pershyi_den.html">День перший: Фукушіма, рухаємося на північ.</a></span>| <span class="blog-toc-item"><a href="/2013/05/21/easy_spawn_new_hosts_with_capistrano.html">Build new hosts with Capistrano and Chef</a></span>| <span class="blog-toc-item"><a href="/2013/05/15/custom_css_for_rt4.html">More about custom CSS for RT4</a></span>| <span class="blog-toc-item"><a href="/2013/03/18/ruby_2_test_drive.html">Ruby 2 test drive</a></span>|</div></table><div id="tiki-bot"><table style="border-:0;border-top:10px solid #000;margin:0;padding:0" cellspacing="0" cellpadding="0" width="100%" columns="2"><tbody><tr style="padding:0;margin:0"><td style="width:80%;background-color:#052D6C;color:#8b0b04;font-style:italic;font-wight:bold;text-align:right;border:0"> <br clear="all"><br clear="all"><br clear="all"><br clear="all"></td><td style="border:0;border-left:10px solid #000;width:120px;padding:5px"> <a class="address" href="mailto:dmytro.kovalov@gmail.com">дмитро ковальов</a></br> <a class="address" href="https://dmytro.github.com/">dmytro @ github </a><br> <a class="address" href="http://dmytro.sytes.net">dmytro.sytes.net</a><br></td></tr></tbody></table></div> <script>$("#content table tr:even").attr("class","even")</script></body></html>